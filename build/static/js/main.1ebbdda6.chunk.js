(this.webpackJsonplambdavibe=this.webpackJsonplambdavibe||[]).push([[0],{115:function(e,t,n){},116:function(e,t,n){},117:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(58),r=n.n(s),c=(n(3),n(6),n(7)),o=n(30),l=n(9),u=n(11),d=n(119),b=n(2),h=n(10),m=function e(t,n){Object(b.a)(this,e),this.type=void 0,this.args=void 0,this.type=t,this.args=Object(h.d)(n)};function j(e,t){var n=t.type,a=t.args;console.debug("".concat(n));var i=function(){switch(n){case"SET_SOCKET":var t=e.get("socket");return t&&t.close(),e.set("socket",a.get("socket"));case"DELETE_SOCKET":return e.delete("socket");case"SET_SONGS":var i=a.get("songs");return e.set("songs",i);case"PLAY_SONG":var s=e.get("songs").find((function(e){return e.get("id")===a.get("id")})).get("notes");return e.set("notes",s);case"STOP_SONG":return e.delete("notes");case"SET_LOCATION":var r,c=a.getIn(["location","pathname"],""),o=a.getIn(["location","search"],""),l=c.substring(1),u=null!==(r=new URLSearchParams(o.substring(1)).get("visualizer"))&&void 0!==r?r:"",d=e.get("instruments"),b=e.get("visualizers"),m=d.find((function(e){return e.name===l})),j=b.find((function(e){return e.name===u}));return e.set("instrument",m).set("visualizer",j);case"SHOW_SONG_DETAILS":var v=a.get("SongDetail");return e.set("SongDetail",v);case"SET_ALBUMS":var f=a.get("albums",Object(h.a)());return e.set("Albums",f);case"SET_ALBUM_SONGS":var g=a.get("Albums",Object(h.a)()),O=a.get("index",Number);return e.set("FilteredSongs",g.get(O).get("songs"));case"SET_GENRES":var p=a.get("genres",Object(h.a)());return e.set("Genres",p);case"SET_GENRE_SONGS":var x=a.get("Genres",Object(h.a)()),w=a.get("index",Number);return e.set("FilteredSongs",x.get(w).get("songs"));case"SEARCH_SONGS":var S=a.get("search",String()),N=a.get("songs",Object(h.a)()),k=[];return N.forEach((function(e){e.get("songTitle").toLowerCase().trim().includes(S.toLowerCase().trim())&&k.push(e)})),e.set("FilteredSongs",k);default:return console.error("type unknown: ".concat(n,"\n"),a.toJS()),e}}();return console.debug(i.update("socket",(function(e){return e?"[socket]":e})).toJS()),i}var v=n(5);function f(e){var t=e.name;return Object(v.jsx)("div",{className:"w-100 h3 bb b--light-gray flex justify-between items-center ph4",children:Object(v.jsx)("div",{children:t})})}var g=function(e){var t=e.instrument,n=e.state,i=e.dispatch,s=t.component,r=Object(a.useState)(new u.c({oscillator:{type:"sine"}}).toDestination()),o=Object(c.a)(r,2),l=o[0],d=o[1],b=n.get("notes");return Object(a.useEffect)((function(){if(b&&l){var e=b.split(" "),t=e.map((function(e,t){return{idx:t,time:"+".concat(t/4),note:e,velocity:1}}));return new u.b((function(t,n){l.triggerAttackRelease(n.note,"4n",t,n.velocity),n.idx===e.length-1&&i(new m("STOP_SONG"))}),t).start(0),u.d.start(),function(){u.d.cancel()}}return function(){}}),[b,l,i]),Object(v.jsxs)("div",{children:[Object(v.jsx)(f,{name:t.name}),Object(v.jsx)("div",{className:"bg-white absolute right-0 left-0",style:{top:"4rem"},children:Object(v.jsx)(s,{name:t.name,state:n,dispatch:i,synth:l,setSynth:d})})]})},O=n(27),p=n.n(O),x=n(118),w=function(e){var t=e.title,n=e.children;return Object(v.jsxs)("div",{className:"flex flex-column h-25 bb b--light-gray pa3",children:[Object(v.jsxs)("div",{className:"fw7 mb2",children:[t," "]}),Object(v.jsx)("div",{className:"flex-auto overflow-scroll",children:n})]})};function S(e){var t=e.to,n=e.text,a=e.active,i=e.onClick;return Object(v.jsx)(o.b,{to:t,className:"no-underline",children:Object(v.jsxs)("div",{className:p()("f6 flex items-center black",{fw7:a}),onClick:i,children:[a?Object(v.jsx)(x.b,{className:"mr1"}):Object(v.jsx)(x.a,{className:"mr1"}),Object(v.jsx)("div",{className:"dim",children:n})]})})}function N(e){var t,n=e.state,a=n.get("instruments"),i=null===(t=n.get("instrument"))||void 0===t?void 0:t.name,s=Object(l.f)();return Object(v.jsx)(w,{title:"Instruments",children:a.map((function(e){return Object(v.jsx)(S,{to:"/".concat(e.name).concat(s.search),text:e.name,active:e.name===i,onClick:function(){return console.log(e.name)}},e.name)}))})}function k(e){var t,n=e.state,a=n.get("visualizers"),i=null===(t=n.get("visualizer"))||void 0===t?void 0:t.name,s=Object(l.f)();return Object(v.jsx)(w,{title:"Visualizers",children:a.map((function(e){return Object(v.jsx)(S,{to:{pathname:s.pathname,search:"?visualizer=".concat(e.name)},text:e.name,active:e.name===i,onClick:function(){return console.log(e.name)}},e.name)}))})}function E(e){var t=e.state,n=e.dispatch;return Object(v.jsxs)("div",{className:"absolute top-0 left-0 bottom-0 w5 z-1 shadow-1 bg-white flex flex-column",children:[Object(v.jsx)("div",{className:"h3 fw7 f5 flex items-center pl3 bb b--light-gray",children:"Music Visualizer"}),Object(v.jsxs)("div",{className:"flex-auto",style:{overflow:"scroll"},children:[Object(v.jsx)(N,{state:t,dispatch:n}),Object(v.jsx)(k,{state:t,dispatch:n})]})]})}var y=n(60),C=n.n(y),T=function e(t,n){Object(b.a)(this,e),this.name=void 0,this.draw=void 0,this.name=t,this.draw=n};function z(e){var t=e.visualizer,n=t.name,i=t.draw,s=Object(a.useMemo)((function(){return new u.a("waveform",256)}),[]),r=Object(a.useCallback)((function(e){var t=window.innerWidth,n=window.innerHeight/2;e.resizeCanvas(t,n,!1)}),[]);Object(a.useEffect)((function(){return u.e().volume.value=-5,u.e().connect(s),function(){u.e().disconnect(s)}}),[s]);return Object(v.jsxs)("div",{className:"bg-black absolute bottom-0 right-0 left-0 h-50",children:[Object(v.jsx)("div",{className:"z-1 absolute left-0 top-0 pa4 white f5",children:n}),Object(v.jsx)(C.a,{setup:function(e,t){var a=window.innerWidth,i=window.innerHeight/2;"3D Waveform"!==n&&"3D Shape"!==n?e.createCanvas(a,i).parent(t):e.createCanvas(a,i,e.WEBGL).parent(t)},draw:function(e){return i(e,s)},windowResized:r})]})}function W(e){var t=e.state,n=e.dispatch,a=t.get("instrument");return Object(v.jsx)("div",{children:a&&Object(v.jsx)(g,{state:t,dispatch:n,instrument:a})})}function _(e){var t=e.state.get("visualizer");return Object(v.jsx)("div",{children:t&&Object(v.jsx)(z,{visualizer:t},t.name)})}function L(e){var t=e.state,n=e.dispatch;return Object(v.jsxs)("div",{className:"absolute right-0 bottom-0 top-0 flex flex-column",style:{left:"16rem"},children:[Object(v.jsx)(W,{state:t,dispatch:n}),Object(v.jsx)(_,{state:t,dispatch:n})]})}function G(e){e.state,e.dispatch;return Object(v.jsx)("div",{className:"absolute right-0 bottom-0 top-0 flex flex-column items-center justify-center",style:{left:"16rem"},children:Object(v.jsxs)("div",{className:"mw6 lh-copy mb4",children:[Object(v.jsx)(d.a,{}),Object(v.jsx)("div",{className:"f3 fw7 mb2",children:"Welcome to the case study."}),Object(v.jsx)("div",{className:"f4 mb3",children:"Select an instrument and a visualizer on the left to serve some fresh beats."})]})})}function D(e){var t=e.state,n=e.dispatch,i=Object(l.f)(),s=!t.get("instrument");return console.log("INSTRUMENT",s),Object(a.useEffect)((function(){n(new m("SET_LOCATION",{location:i}))}),[n,i]),Object(v.jsxs)("div",{className:"fixed top-0 left-0 h-100 w-100 bg-white",onClick:function(){return u.f()},children:[Object(v.jsx)(E,{state:t,dispatch:n}),s?Object(v.jsx)(G,{state:t,dispatch:n}):Object(v.jsx)(L,{state:t,dispatch:n})]})}function A(e){var t=e.note,n=e.synth,a=e.minor,i=e.index;return Object(v.jsx)("div",{onMouseDown:function(){return null===n||void 0===n?void 0:n.triggerAttack("".concat(t))},onMouseUp:function(){return null===n||void 0===n?void 0:n.triggerRelease("+0.25")},className:p()("ba pointer absolute dim",{"bg-black black h3":a,"black bg-white h4":!a}),style:{top:0,left:"".concat(2*i,"rem"),zIndex:a?1:0,width:a?"1.5rem":"2rem",marginLeft:a?"0.25rem":0}})}function M(e){var t=e.title,n=e.onClick,a=e.active;return Object(v.jsx)("div",{onClick:n,className:p()("dim pointer ph2 pv1 ba mr2 br1 fw7 bw1",{"b--black black":a,"gray b--light-gray":!a}),children:t})}var R=new function e(t,n){Object(b.a)(this,e),this.name=void 0,this.component=void 0,this.name=t,this.component=n}("Piano",(function(e){var t=e.synth,n=e.setSynth,a=Object(h.a)([{note:"C",idx:0},{note:"Db",idx:.5},{note:"D",idx:1},{note:"Eb",idx:1.5},{note:"E",idx:2},{note:"F",idx:3},{note:"Gb",idx:3.5},{note:"G",idx:4},{note:"Ab",idx:4.5},{note:"A",idx:5},{note:"Bb",idx:5.5},{note:"B",idx:6}]),i=Object(h.a)(["sine","sawtooth","square","triangle","fmsine","fmsawtooth","fmtriangle","amsine","amsawtooth","amtriangle"]);return Object(v.jsxs)("div",{className:"pv4",children:[Object(v.jsx)("div",{className:"relative dib h4 w-100 ml4",children:Object(h.c)(2,7).map((function(e){return a.map((function(n){var a=-1!==n.note.indexOf("b"),i="".concat(n.note).concat(e);return Object(v.jsx)(A,{note:i,synth:t,minor:a,octave:e,index:7*(e-2)+n.idx},i)}))}))}),Object(v.jsx)("div",{className:"pl4 pt4 flex",children:i.map((function(e){return Object(v.jsx)(M,{title:e,onClick:function(){return t=e,void n((function(e){return e.disconnect(),new u.c({oscillator:{type:t}}).toDestination()}));var t},active:(null===t||void 0===t?void 0:t.oscillator.type)===e},e)}))})]})})),H=new T("Waveform",(function(e,t){var n=window.innerWidth,a=window.innerHeight/2,i=Math.min(n,a);e.background(0,0,0,255),e.strokeWeight(.01*i),e.stroke(255,255,255,255),e.noFill();var s=t.getValue();e.beginShape();for(var r=0;r<s.length;r++){var c=s[r],o=e.map(r,0,s.length-1,0,n),l=a/2+c*a;e.vertex(o,l)}e.endShape()})),I=new T("3D Shape",(function(e,t){var n=window.innerWidth,a=window.innerHeight/2;e.background("black");var i=t.getValue(),s=e.mouseX-a/2,r=e.mouseY-n/2;e.ambientLight(50),e.directionalLight(255,0,0,.25,.25,0),e.pointLight(0,0,255,s,r,250),e.beginShape(),e.rotateZ(.02*e.frameCount),e.rotateX(.02*e.frameCount),e.specularMaterial(250),e.translate(-n/10,0,0);for(var c=0;c<i.length;c++){var o=i[c],l=e.map(c,0,i.length-1,0,o*a)+n,u=a/2+o*n+a;e.push(),e.box(.07*l,.15*u,100),e.pop()}e.endShape()})),F=new T("Circle Waveform",(function(e,t){var n=window.innerWidth,a=window.innerHeight/2,i=Math.min(n,a);e.angleMode("degrees"),e.background(0,0,0,255),e.stroke(255,0,127),e.strokeWeight(.02*i),e.noFill(),e.translate(n/2.5,a/2);var s=t.getValue();e.beginShape();for(var r=0;r<=180;r++){var c=e.floor(e.map(r,0,180,0,s.length-1)),o=(u=e.map(s[c],-1,1,150,300))*e.sin(r),l=u*e.cos(r);e.vertex(o,l)}e.endShape(),e.beginShape();for(r=0;r<=180;r++){var u;c=e.floor(e.map(r,0,180,0,s.length-1)),o=(u=e.map(s[c],-1,1,150,300))*-e.sin(r),l=u*e.cos(r);e.vertex(o,l)}e.endShape()})),V=new T("Elliptical Nebular Waveform",(function(e,t){var n=window.innerWidth,a=window.innerHeight/2;e.background(0,0,0,210),e.stroke(255,0,127),e.strokeWeight(3),e.noFill();var i=t.getValue();e.beginShape(),i.forEach((function(t,s){var r=i[s];e.ellipse(600,200,300+n*r,150+a*r),e.ellipse(600,200,150+a*r,300+n*r)})),e.endShape()})),B=new T("3D Waveform",(function(e,t){var n=window.innerWidth,a=window.innerHeight/2;e.background(250,250,250,255);var i=t.getValue();e.beginShape(),e.rotateY(.01*e.frameCount),e.rotateX(.01*e.frameCount);for(var s=0,r=0,c=0,o=0;o<i.length;o++){var l=i[o],u=e.map(o,0,i.length-1,0,n)-n/2,d=a/2+l*a-a/2;o%2===0?(e.translate(u-s,d-r,.1*o-c),c=.1*o):(e.translate(u-s,d-r,-.1*o-c),c=-.1*o),e.push(),e.sphere(8,6,4),e.pop(),s=u,r=d}e.endShape()})),P=Object(h.a)([R]),U=Object(h.a)([H,F,V,B,I]),J=Object(h.b)({instruments:P,visualizers:U}),K=(n(4),n(21),n(61)),X={transports:["websocket"],path:"/ws",autoConnect:!0,reconnection:!0,timeout:1e4};n(114);var Y=function(){var e=Object(a.useReducer)(j,J),t=Object(c.a)(e,2),n=t[0],i=t[1];return Object(a.useEffect)((function(){!function(e,t){var n=Object(K.io)("ws://localhost:3000",X);n.on("connect",(function(){})),n.on("disconnect",t)}(0,(function(){i(new m("DELETE_SOCKET"))}))}),[]),Object(v.jsx)(o.a,{children:Object(v.jsxs)(l.c,{children:[Object(v.jsx)(l.a,{path:"/",children:Object(v.jsx)(D,{state:n,dispatch:i})}),Object(v.jsx)(l.a,{path:"/:instrument",children:Object(v.jsx)(D,{state:n,dispatch:i})}),Object(v.jsx)(l.a,{path:"*",children:Object(v.jsx)("div",{children:"404"})})]})})};n(115),n(116);var q=document.getElementById("root");r.a.render(Object(v.jsx)(i.a.StrictMode,{children:Object(v.jsx)(Y,{})}),q,(function(){console.log("React has loaded.")}))}},[[117,1,2]]]);
//# sourceMappingURL=main.1ebbdda6.chunk.js.map